# 娱乐赌场项目说明书

## 项目概述
娱乐赌场是一个纯娱乐性质的移动端小游戏应用，使用Flutter开发，支持Android和iOS（通过TestFlight）平台。项目采用纯本地运行模式，无需服务器，所有数据存储在设备本地。

## 版本历史

### v0.0.1
- 基础21点游戏实现
- 简单的发牌、要牌、停牌逻辑
- 基本的UI界面

### v0.0.2（当前版本）
已实现的需求：

#### 1. 主页面系统 ✅
- 游戏启动后显示主页面，展示"21点"、"敬请期待"等游戏模块
- 显示用户名和余额信息
- 点击"21点"进入游戏，余额不足时提示

#### 2. 用户系统 ✅
- 首次进入游戏需要填写用户名，自动赠送6000 Y币
- 用户名和余额自动保存在本地（SharedPreferences）
- 非首次进入自动加载用户余额

#### 3. 天使投资系统 ✅
- 主页面提供"天使投资"入口
- 可借款5000 Y币，借款行为被记录（金额、时间）
- 显示历史借款余额（负值表示欠款）

#### 4. 还款系统 ✅
- 支持自定义还款金额
- 从账户余额扣除还款金额
- 更新借款余额，记录还款历史

#### 5. 游戏准入控制 ✅
- 21点游戏最低下注金额为200 Y币
- 当前用户余额低于200 Y币时，无法进入21点游戏
- 余额不足时提示前往天使投资借款

#### 6. 游戏规则更新（部分实现） ⚠️
- **已实现**：
  - 使用6副牌进行游戏
  - 洗牌靴规则（剩余牌数低于25%~30%时自动重新洗牌）
  - 游戏流程：玩家下注 → 发牌（玩家两张明牌，庄家一明一暗） → 玩家操作 → 庄家操作
- **待实现**：
  - 加倍功能（前两张牌时可选择）
  - 分牌功能（前两张牌点数相同时可分牌）
  - Blackjack（天然21点）特殊赔率（1:1.5）

#### 7. 庄家操作优化 ✅
- 玩家停牌或爆牌后，庄家每步操作延迟1秒
- 逐步显示庄家要牌过程，提升用户体验

#### 8. 游戏结束流程改进 ✅
- 每局游戏结束后，在结果横幅下方增加"继续游戏"和"退出游戏"按钮
- "继续游戏"：开始新一局，重置游戏状态
- "退出游戏"：返回主页面

#### 9. 游戏界面余额展示 ✅
- 21点游戏界面顶部显示当前余额
- 余额不足最低下注额度时，只能点击退出游戏
- 点击"继续游戏"时检查余额，不足则提示前往天使投资

#### 10. 游戏说明功能 ✅
- 21点游戏界面增加"游戏说明"按钮（问号图标）
- 点击显示完整的游戏规则和操作指南

## 技术架构

### 目录结构
```
casino_app/
├── lib/
│   ├── main.dart              # 应用入口，配置主页路由
│   ├── home_screen.dart       # 主页面，游戏入口和用户信息
│   ├── game_screen.dart       # 21点游戏主界面
│   ├── angel_investment_screen.dart  # 天使投资页面
│   ├── game_logic.dart        # 游戏逻辑核心（牌组、规则、状态）
│   ├── models/
│   │   └── user.dart          # 用户数据模型
│   └── services/
│       └── local_storage.dart # 本地存储服务
├── android/                   # Android平台配置
├── ios/                       # iOS平台配置
└── pubspec.yaml              # 项目依赖配置
```

### 核心组件说明

#### 1. 用户系统
- **User类**：存储用户名、余额、借款余额、借款历史
- **LoanRecord类**：借款/还款记录，包含金额、时间、类型
- **LocalStorage类**：基于SharedPreferences的本地存储，使用JSON序列化

#### 2. 游戏逻辑
- **Deck类**：支持多副牌（默认6副），可配置洗牌靴规则
- **BlackJackGame类**：游戏状态管理，包含玩家/庄家手牌、分数计算、游戏状态
- **GameStatus枚举**：playing, playerWon, dealerWon, tie, playerBusted, dealerBusted

#### 3. 用户界面
- **HomeScreen**：应用主页，用户首次进入时输入用户名
- **GameScreen**：21点游戏界面，包含庄家/玩家区域、控制按钮、游戏状态
- **AngelInvestmentScreen**：天使投资界面，提供借款、还款、历史记录功能

## 配置与自定义

### 牌组配置
在`game_logic.dart`的`Deck`类构造函数中可配置：
```dart
Deck(
  numDecks: 6,           // 牌副数，默认6副
  useShoe: false,        // 是否启用洗牌靴规则，默认false
  reshufflePercent: 0.25 // 重新洗牌阈值（剩余牌百分比），默认25%
)
```

### 游戏参数
- 初始赠送金额：6000 Y币（在`User.initial`中设置）
- 借款金额：5000 Y币（在`AngelInvestmentScreen`中设置）
- 最低下注：200 Y币（在`HomeScreen`和`GameScreen`中检查）

## 运行与构建

### 开发运行
```bash
cd casino_app
flutter pub get
flutter run -d linux    # Linux桌面
flutter run -d android  # Android设备
```

### 构建APK
```bash
cd casino_app
flutter build apk --release
```

### 本地下载服务器
```bash
./start_server.sh
# 访问 http://localhost:8000 下载APK
```

## 未来扩展建议

### 短期计划
1. **完整游戏规则实现**
   - 加倍功能
   - 分牌功能
   - Blackjack特殊赔率结算

2. **用户体验优化**
   - 游戏动画效果
   - 音效系统
   - 主题切换（深色/浅色模式）

### 长期规划
1. **新游戏添加**
   - 德州扑克
   - 轮盘赌
   - 老虎机

2. **社交功能**
   - 好友排行榜
   - 成就系统
   - 游戏历史分享

## 注意事项

1. **娱乐性质**：本项目为纯娱乐软件，不涉及真实货币交易
2. **数据安全**：所有用户数据存储在设备本地，无云端同步
3. **平台限制**：iOS版本需通过TestFlight分发
4. **法律合规**：请勿用于赌博活动，开发者不对任何滥用行为负责

## 故障排除

### 常见问题
1. **无法进入21点游戏**：检查余额是否低于200 Y币，前往天使投资借款
2. **借款记录不显示**：确保已成功借款，历史记录可能需要刷新
3. **游戏卡顿**：庄家操作每步延迟1秒，属正常设计

### 技术支持
如遇技术问题，请：
1. 检查Flutter环境：`flutter doctor`
2. 清理构建缓存：`flutter clean`
3. 查看详细日志：`flutter run -v`

---

**最后更新**：2026年1月18日
**版本**：v0.0.2
**状态**：核心功能已完成，部分高级游戏规则待实现